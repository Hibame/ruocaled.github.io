"use strict";angular.module("clashApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("clashApp").factory("Squad",["Tank","Spear","Healer","Archer",function(a,b,c,d){function e(a,b){this.w=a,this.h=b,this.list=[],this.init()}var f=[a,b,c,d];return e.prototype.init=function(){var a=this.w,b=this.h;if(this.w&&this.h)for(var c=0;a>c;c++){for(var d=[],e=0;b>e;e++){var g=new(f[Math.floor(4*Math.random())]);g.x=c,g.y=e,d[e]=g}this.list[c]=d}console.log("DONE INIT PROGRESS..")},e.prototype.getSoldierByPos=function(a,b){return this.list[a]&&this.list[a][b]?this.list[a][b]:!1},e.prototype.getMatrix=function(){return this.list},e.prototype.swap=function(a,b){function c(a,b){var c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y);return 1!==c&&1!==d||c+d===2?!1:!0}if(c(a,b)){console.log("same row");var d=this.list;d[a.x][a.y]=b,d[b.x][b.y]=a;var e=a.x,f=a.y;return a.x=b.x,a.y=b.y,b.x=e,b.y=f,!0}return!1},e}]),angular.module("clashApp").controller("MainCtrl",["$scope","Squad","Dead","Spear","Healer","Tank","Archer",function(a,b,c,d,e,f,g){var h=null,i=null,j=[],k=[d,e,f,g],l=8,m=4,n=new b(m,l),o=new b(m,l);a.totalNumSoldiers=l*m,a.gameOver=!1,a.turn=0,a.movesLeft=10,a.MAXMOVESLEFT=a.movesLeft,a.score=0,a.enemyMatrix=n.getMatrix(),a.matrix=o.getMatrix(),a.resetGame=function(){h=null,i=null,j=[],n=new b(m,l),o=new b(m,l),a.totalNumSoldiers=l*m,a.gameOver=!1,a.turn=0,a.movesLeft=10,a.MAXMOVESLEFT=a.movesLeft,a.score=0,a.enemyMatrix=n.getMatrix(),a.matrix=o.getMatrix()},a.range=function(a){return new Array(a)},a.displayClass={selected:function(a){return a===h?"selected":""},highlighted:function(a){return-1!==j.indexOf(a)?"highlighted":""},getGemClass:function(b){return b>=a.movesLeft?"gem-empty":"gem-full"}},a.clearRangesHighlight=function(){j=[]},a.showInRanges=function(b,c){console.log(j);var d,f,g=c.x,h=c.y;b?(d=a.matrix,f=a.enemyMatrix):(d=a.enemyMatrix,f=a.matrix),c instanceof e?(d[g-1]&&d[g-1][h]&&j.push(d[g-1][h]),d[g+1]&&d[g+1][h]&&j.push(d[g+1][h]),d[g]&&d[g][h-1]&&j.push(d[g][h-1]),d[g]&&d[g][h+1]&&j.push(d[g][h+1])):f[c.attackRange-1-g]&&f[c.attackRange-1-g][h]&&j.push(f[c.attackRange-1-g][h])},a.getAbsPos=function(a,b){var c={},d=50;return a?c.bottom=60*b.x+"px":c.top=60*b.x+"px",c.left=60*b.y+d+"px",c},a.awesomeThings=[o.w,"AngularJS","Karma"],a.clash=function(){function b(){function b(a,b){if(a&&"dead"!==a.className){var d=a.x,e=a.y;b[d-1]&&b[d-1][e]&&c(b[d-1][e]),b[d+1]&&b[d+1][e]&&c(b[d+1][e]),b[d]&&b[d][e-1]&&c(b[d][e-1]),b[d]&&b[d][e+1]&&c(b[d][e+1])}}function c(a){var b=(a.health,a.health+1);a.health=Math.min(b,a.MAXHEALTH),console.log("healed")}for(var d=a.matrix,e=a.enemyMatrix,f=0;m>f;f++)for(var g=0;l>g;g++){var h=d[f][g],i=e[f][g];h&&"healer"===h.className&&b(h,d),i&&"healer"===i.className&&b(i,e)}}function d(){for(var b=a.matrix,c=a.enemyMatrix,d=0;2>d;d++)for(var e=0;l>e;e++){var f=b[d][e],g=c[d][e];if(f){if("dead"===f.className)continue;if(0===d){if(1===f.attackRange)f&&g&&(1===g.attackRange&&(f.health-=g.attack),g.health-=f.attack);else if(f&&g&&(console.log("range soldier get attacked!"),f.health-=g.attack),f){var h=f.attackRange-1-f.x;if(c[h]){var i=c[h][f.y];i&&(i.health-=f.attack)}}}else if(f.attackRange>f.x){var h=f.attackRange-1-f.x;if(c[h]){var i=c[h][f.y];i&&(i.health-=f.attack)}}}}}function e(){function b(a,b,c){var d=a[b][c];d&&d.health<1&&"dead"!==d.className&&(console.log("fire arrow"),a[b][c]=void 0)}function d(b,d,e,f,g){var h=b[d][e];if(!h){for(console.log("find dead body");b[d+1]&&b[d+1][e]&&b[d+1][e]instanceof c!=!0;)b[d][e]=b[d+1][e],b[d][e].x=d,b[d][e].y=e,d+=1;if(g){a.score++;var i=new(k[Math.floor(4*Math.random())]);i.x=d,i.y=e,b[d][e]=i}else b[d][e]=new c,b[d][e].x=d,b[d][e].y=e,a.totalNumSoldiers--,a.totalNumSoldiers<=0&&(a.gameOver=!0)}}for(var e=a.matrix,f=a.enemyMatrix,g=0;2>g;g++)for(var h=0;l>h;h++)b(e,g,h,o),b(f,g,h,n);for(var g=0;2>g;g++)for(var h=0;l>h;h++)d(e,g,h,o,!1),d(f,g,h,n,!0)}h=null,i=null,b(),d(),e(),a.turn++,a.movesLeft=10},a.reportPos=function(a){console.log(a.x,a.y)},a.go=function(b){a.movesLeft>0&&(console.log(b),h?h===b?h=null:i=b:h=b,i&&(console.log("swap"),o.swap(h,i)?(h=null,i=null,a.movesLeft--):(h=i,i=null)),console.log("selected:"+h),console.log("targeted:"+i))}}]),angular.module("clashApp").factory("Soldier",function(){function a(){this.moved=!1,this.x,this.y}return a.prototype.attack=function(){this.moved=!0},a.prototype.swap=function(){this.moved=!0},a}),angular.module("clashApp").factory("Tank",["Soldier",function(a){function b(){a.call(this),this.className="tank",this.health=8,this.MAXHEALTH=this.health,this.attackRange=1,this.attack=2}return b.prototype=new a,b}]),angular.module("clashApp").factory("Archer",["Soldier",function(a){function b(){a.call(this),this.className="archer",this.health=2,this.MAXHEALTH=this.health,this.attackRange=2,this.attack=2}return b.prototype=new a,b}]),angular.module("clashApp").factory("Healer",["Soldier",function(a){function b(){a.call(this),this.className="healer",this.health=2,this.MAXHEALTH=this.health,this.attackRange=1,this.attack=2}return b.prototype=new a,b}]),angular.module("clashApp").factory("Spear",["Soldier",function(a){function b(){a.call(this),this.className="spear",this.health=4,this.MAXHEALTH=this.health,this.attackRange=1,this.attack=3}return b.prototype=new a,b}]),angular.module("clashApp").factory("Game",["Squad",function(){function a(){this.state="idel",this.moves=10,this.turn=0,this.selected=null,this.targeted=null}return a.prototype.clash=function(){this.nextTurn()},a.prototype.nextTurn=function(){this.turn++,this.moves=10},a}]),angular.module("clashApp").factory("Dead",["Soldier",function(a){function b(){a.call(this),this.className="dead",this.health=0,this.MAXHEALTH=this.health,this.attackRange=0,this.attack=0}return b.prototype=new a,b}]);